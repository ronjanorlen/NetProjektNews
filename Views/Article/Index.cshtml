@using Microsoft.AspNetCore.Identity
@inject SignInManager<IdentityUser> SignInManager
@inject UserManager<IdentityUser> UserManager
@model IEnumerable<NetProjektNews.Models.Article>

@{
    ViewData["Title"] = "Nyheter";
}

<h1>Senaste nytt</h1>
@if (SignInManager.IsSignedIn(User) && (User.IsInRole("Admin") || User.IsInRole("Editor")))
{
<p>
    <a asp-action="Create">Skapa nyhet</a>
</p>
}


@foreach (var item in Model)
{
    <section class="news-article">
        <h2>@item.Title</h2>
        <p><strong>Publicerad av:</strong> @item.CreatedBy</p>
        <p><strong>Datum:</strong> @item.CreatedAt.ToString("yyyy-MM-dd")</p>
        <p>@item.Content</p>
        
        @if (!string.IsNullOrEmpty(item.ImageName))
        {
            <a href="images/@item.ImageName">
                <img src="images/thumb_@item.ImageName" alt="Bild på @item.Title">
            </a>
        }

        <p><strong>Kategori:</strong> @(item.Category?.CategoryName ?? "Inte valt")</p>

    @if (SignInManager.IsSignedIn(User) && (User.IsInRole("Admin") || User.IsInRole("Editor")))
    { // Visa bara om editor eller admin är inloggad 
        <p>
            <a asp-action="Edit" asp-route-id="@item.Id">Redigera</a> |
            <a asp-action="Details" asp-route-id="@item.Id">Detaljer</a> |
            <a asp-action="Delete" asp-route-id="@item.Id">Ta bort</a>
        </p>
        }
    </section>
}
